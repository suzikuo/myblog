---
title: TCP 重传、滑动窗口、流量控制、拥塞控制知识汇总
tags: 
- tcp
categories:
- tcp
date: 2024-01-19 17:40:18
---

> 本文对此文章做出了个人的总计。
> [**TCP 重传、滑动窗口、流量控制、拥塞控制**](https://www.xiaolincoding.com/network/3_tcp/tcp_feature.html#%E9%87%8D%E4%BC%A0%E6%9C%BA%E5%88%B6)

- [一、重传机制](#一重传机制)
  - [1.1 超时重传](#11-超时重传)
    - [1.1.1 RTT、RTO是什么？](#111-rttrto是什么)
    - [1.1.2 RTO较大或较小会如何？](#112-rto较大或较小会如何)
    - [1.1.3 RTO设置多大合适？](#113-rto设置多大合适)
  - [1.2 快速重传](#12-快速重传)
    - [1.2.1 工作方式](#121-工作方式)
    - [1.2.2 面临的问题](#122-面临的问题)
  - [1.3 SACK](#13-sack)
    - [1.3.1 工作方式](#131-工作方式)
  - [1.4 D-SACK](#14-d-sack)
    - [1.4.1 定义](#141-定义)
    - [1.4.2 应答丢失](#142-应答丢失)
    - [1.4.3 网络延迟导致导致重传](#143-网络延迟导致导致重传)
  - [二、滑动窗口](#二滑动窗口)
  - [2.1 定义](#21-定义)



# 一、重传机制
## 1.1 超时重传

> 在发送数据时，设定一个定时器，当超过指定的时间后，没有收到对方的 ACK 确认应答报文，就会重发该数据。

### 1.1.1 RTT、RTO是什么？
![](https://img-blog.csdnimg.cn/direct/b8fed3a62b024a1aa655b1a15a36fc30.png)


 - **RTT（Round-Trip Time 往返时延）**:从客户端向服务端发送一个数据包开始，到接到服务端的应答结束，此段时间即为RTT(包的往返时间)。
 - **RTO（Retransmission Timeout 超时重传时间）**: 客户端在RTO时间内没收到服务端的应答时，会触发重传机制。

### 1.1.2 RTO较大或较小会如何？

 - **若RTO较大时**：重发就慢，丢了老半天才重发，没有效率，性能差。
 - **若RTO较小时**：会导致可能并没有丢就重发，于是重发的就快，会增加网络拥塞，导致更多的超时，更多的超时导致更多的重发。

### 1.1.3 RTO设置多大合适？

 1. 超时重传时间 RTO 的值应该**略大于**报文往返 RTT 的值。
 2. RTO需要根据来往的请求动态进行计算。
 3. 如果超时重发的数据，再次超时的时候，又需要重传的时候，TCP 的策略是**超时间隔加倍**(每次遇到超时重传，RTO都会×2)。

## 1.2 快速重传

> 不以时间驱动重传，而是以数据(应答)来驱动重传。

![](https://img-blog.csdnimg.cn/direct/b67b77e5a4cc4615b4156cc12058e304.png)
### 1.2.1 工作方式

> 快速重传的工作方式是当收到**三个相同的 ACK 报文**时，会在定时器过期之前，**重传丢失的报文段**。

### 1.2.2 面临的问题
快速重传解决了超时时间的问题，但如果丢失多个seq，那么需要每个seq都要收到三个相同的ACK才可以进行重传。那么快速重传时，是传一个seq，还是传递之后所有的seq？
 - 传一个：每个seq都要收到三个相同的ACK才会继续重传，效率很低。
 - 传多个：每次重传都重传之后的seq，因为接收端已接收到了这些seq，导致重复接收，浪费资源。



## 1.3 SACK
### 1.3.1 工作方式

> 这种方式需要在 **TCP 头部「选项」字段里加一个 SACK** 的东西，它可以**将已收到的数据的信息发送给「发送方」**，这样发送方就可以知道哪些数据收到了，哪些数据没收到，知道了这些信息，就可以**只重传丢失的数据**。

![](https://img-blog.csdnimg.cn/direct/5c31c285c8d9444bbee0de966801e38a.png)
200~299数据丢失，与快速重传一样，在收到三次相同的ACK后，触发重传，根据SACK，重传所有丢失的数据。
## 1.4 D-SACK
### 1.4.1 定义

> 告诉接收方，哪些数据被重传了。
> 告诉发送方，数据为什么被重传了。
### 1.4.2 应答丢失
![](https://img-blog.csdnimg.cn/direct/cb455633145e4b3199df05cebf082476.png)
### 1.4.3 网络延迟导致导致重传
![](https://img-blog.csdnimg.cn/direct/b28425aa0bf543c0a08a77b7153e7934.png)
## 二、滑动窗口
## 2.1 定义
> 系统开辟的一定大小的缓存区间。将发送方发送的一定大小的数据存放到窗口，无需等待应答。
> 窗口的大小指无需等待应答，而且可以连续发送数据的最大值。
> 收到应答之后，将会从缓冲区删除掉该数据，则可以继续发送数据。

![](https://img-blog.csdnimg.cn/direct/4886b7589e7f403cb87638e5ffc9d3ce.png)
发送窗口 + 可用窗口 = 窗口的大小
当可用窗口为0时，无法再接收数据。

当ACK应答之后
![](https://img-blog.csdnimg.cn/direct/187b5fee58d2491f9f087da465ba01db.png)
可用窗口变大，则可以继续发送。
